<!DOCTYPE html>
<html lang="zh-Hant">
<head>
  <meta charset="UTF-8" />
  <!-- 手機通用 viewport，比例用 CSS 控制，不把 744x1024 寫死 -->
  <meta name="viewport"
        content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no, viewport-fit=cover" />
  <title>修仙RPG｜登入</title>
  <style>
    :root{
      /* 顏色主題：延續你的配色習慣 */
      --bg:#0b1024; --bg2:#0e1536; --panel:#131a3f; --muted:#9aa3b2; --text:#eaf2ff;
      --accent:#8b5cf6; --accent2:#22d3ee; --ok:#22c55e; --warn:#f59e0b; --danger:#ef4444;
      --radius:16px; --gap:14px; --shadow:0 10px 28px rgba(0,0,0,.35);
    }
    *{box-sizing:border-box;-webkit-tap-highlight-color:transparent}
    html,body{height:100%; margin:0; font-family:"Microsoft JhengHei",system-ui,Segoe UI,Roboto,sans-serif; color:var(--text); background:var(--bg);}
    /* 舞台置中：讓 app 永遠在正中央 */
    .stage{position:fixed; inset:0; display:grid; place-items:center; overflow:hidden;}
    /* 核心畫面：維持 93:128 比例，自適應縮放，不寫死像素 */
    .app{
      aspect-ratio: 93 / 150;                /* === 93:128 比例（744:1024 化簡）=== */
      width: min(100svw, calc(100svh * 93/150));
      max-height: 100svh;
      background: linear-gradient(180deg, var(--bg2), var(--panel));
      border-radius: var(--radius);
      box-shadow: var(--shadow);
      display:flex; flex-direction:column;
      overflow:auto;
    }
    header{
      padding: 16px 18px; font-weight:700; letter-spacing:.5px;
      background: rgba(255,255,255,.04);
      border-radius: var(--radius) var(--radius) 0 0;
    }
    .screen{padding: 20px 18px 28px; display:flex; flex-direction:column; gap:var(--gap);}
    h1{font-size:clamp(18px,3.6vw,24px); margin:6px 0 2px;}
    p.sub{margin:0; color:var(--muted); font-size:14px}

    .card{
      background: rgba(255,255,255,.05);
      border:1px solid rgba(255,255,255,.06);
      border-radius: var(--radius);
      padding: 16px;
      box-shadow: inset 0 0 0 1px rgba(0,0,0,.1);
    }
    .field{display:flex; flex-direction:column; gap:8px;}
    .field label{font-size:13px; color:var(--muted)}
    input[type="text"], input[type="password"], .select, button{
      width:100%; border:none; border-radius:12px; padding:12px 14px; font-size:16px;
    }
    input[type="text"], input[type="password"], .select{background:#fff; color:#111;}
    button{
      background:linear-gradient(135deg,var(--accent),var(--accent2)); color:#fff; font-weight:700;
      box-shadow:var(--shadow); cursor:pointer;
    }
    button.ghost{
      background:transparent; color:#fff; border:1px solid rgba(255,255,255,.2);
      box-shadow:none;
    }

    .row{display:flex; gap:12px;}
    .row > *{flex:1}

    .msg{font-size:14px; color:var(--danger); min-height:1.2em}
    .hidden{display:none;}

    /* 元素選擇：行動版友善的卡片式單選 */
    .elements{display:grid; grid-template-columns:repeat(3,1fr); gap:10px;}
    .elem{
      position:relative; padding:12px; border-radius:12px; background:rgba(255,255,255,.06);
      border:1px solid rgba(255,255,255,.12); text-align:center; cursor:pointer; user-select:none;
    }
    .elem input{position:absolute; inset:0; opacity:0; pointer-events:none;}
    .elem .name{display:block; font-weight:700}
    .elem .desc{display:block; font-size:12px; color:var(--muted)}
    .elem.active{outline:2px solid var(--accent2); background:rgba(34,211,238,.12)}
    footer.note{padding:12px 18px; color:var(--muted); font-size:12px;}
  </style>
</head>
<body>
  <div class="stage">
    <div class="app" id="app">
      <header>
        修仙RPG｜帳號登入
      </header>

      <!-- === 登入畫面 === -->
      <section id="screen-login" class="screen">
        <div class="card">
          <h1>登入</h1>
          <p class="sub">輸入帳號與密碼，首次登入若無角色會進入創角畫面。</p>
          <div class="field">
            <label for="loginUser">帳號</label>
            <input id="loginUser" type="text" placeholder="例如：player1 / test" autocomplete="username" />
          </div>
          <div class="field">
            <label for="loginPass">密碼</label>
            <input id="loginPass" type="password" placeholder="密碼" autocomplete="current-password" />
          </div>
          <div class="msg" id="loginMsg"></div>
          <div class="row">
            <button id="btnLogin">登入</button>
            <button id="btnQuick" class="ghost" title="快速填入測試帳">一鍵測試</button>
          </div>
        </div>
      </section>

      <!-- === 創建角色畫面（首次無角色時顯示） === -->
      <section id="screen-create" class="screen hidden">
        <div class="card">
          <h1>創建角色</h1>
          <p class="sub">輸入角色名稱並選擇初始元素（可選：無 / 水 / 火）。</p>

          <div class="field">
            <label for="charName">角色名稱</label>
            <input id="charName" type="text" placeholder="請輸入角色名稱" />
          </div>

          <div class="field">
            <label>初始元素</label>
            <div class="elements" id="elementGrid">
              <!-- 單選卡 -->
              <label class="elem" data-value="none">
                <input type="radio" name="elem" value="none" checked />
                <span class="name">無元素</span>
                <span class="desc">平衡起步</span>
              </label>
              <label class="elem" data-value="water">
                <input type="radio" name="elem" value="water" />
                <span class="name">水元素</span>
                <span class="desc">回復／控制</span>
              </label>
              <label class="elem" data-value="fire">
                <input type="radio" name="elem" value="fire" />
                <span class="name">火元素</span>
                <span class="desc">爆發／灼燒</span>
              </label>
            </div>
          </div>

          <div class="row">
            <!-- 依你的要求：按鈕「先不要定義」跳轉；這裡只觸發建立資料 -->
            <button id="btnCreate">確認創建</button>
            <button id="btnBackLogin" class="ghost">返回登入</button>
          </div>
        </div>
      </section>

      <footer class="note">
        畫面以 <strong>93∶128</strong> 比例自動縮放，未寫死解析度；適配手機直向。
      </footer>
    </div>
  </div>

  <!-- 模擬帳號資料庫／登入邏輯 -->
<!-- 置於 index.html 末尾的 <script> 內，覆蓋原邏輯 -->
<script src="auth.js"></script>
<script>
  const scrLogin   = document.getElementById('screen-login');
  const scrCreate  = document.getElementById('screen-create');
  const loginMsg   = document.getElementById('loginMsg');
  const elGrid     = document.getElementById('elementGrid');
  const loginUser  = document.getElementById('loginUser');
  const loginPass  = document.getElementById('loginPass');

  // ★ 新增：如果從 game.html 被導回 index.html#create，就直接打開創角畫面
  if (location.hash === '#create') {
    scrLogin.classList.add('hidden');
    scrCreate.classList.remove('hidden');
  }

  elGrid.addEventListener('click', (e)=>{
    const card = e.target.closest('.elem'); if(!card) return;
    [...elGrid.querySelectorAll('.elem')].forEach(el=>el.classList.remove('active'));
    card.classList.add('active');
    card.querySelector('input[type="radio"]').checked = true;
  });

  document.getElementById('btnQuick').addEventListener('click', ()=>{
    loginUser.value = 'test';
    loginPass.value = '1234';
  });

  document.getElementById('btnLogin').addEventListener('click', ()=>{
    const u = loginUser.value.trim();
    const p = loginPass.value.trim();
    const { success, message, hasCharacter } = Auth.login(u, p);

    if(!success){ loginMsg.textContent = message || '登入失敗'; loginMsg.style.color='var(--danger)'; return; }
    loginMsg.style.color = 'var(--ok)';
    loginMsg.textContent = '登入成功';

    if(!hasCharacter){
      scrLogin.classList.add('hidden');
      scrCreate.classList.remove('hidden');
    }else{
      // 已有角色 → 直接進遊戲
      window.location.href = 'game.html';
    }
  });

  document.getElementById('btnCreate').addEventListener('click', ()=>{
    const name = (document.getElementById('charName').value || '').trim();
    const elem = (elGrid.querySelector('input[name="elem"]:checked') || {}).value || 'none';
    if(!name){ alert('請輸入角色名稱'); return; }

    const ok = Auth.createCharacter(name, elem);
    if(ok){
      // 創角完成 → 進遊戲
      window.location.href = 'game.html';
    }else{
      alert('創角失敗，請重試');
    }
  });

  document.getElementById('btnBackLogin').addEventListener('click', ()=>{
    scrCreate.classList.add('hidden');
    scrLogin.classList.remove('hidden');
  });
</script>
</body>
</html>
